import{s as t,v as i,c as n,w as e,i as s,o,a,b as r,e as h}from"./index-6ha-q1NO.js";import{a as u}from"./sizhu.BasLQ5LL.js";import{l as g}from"./index.BHYqNsFk.js";import{_ as l}from"./_plugin-vue_export-helper.BCo6x5W8.js";const c=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],m=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],f={"寅":"午","午":"午","戌":"午","亥":"卯","卯":"卯","未":"卯","申":"子","子":"子","辰":"子","巳":"酉","酉":"酉","丑":"酉"},d={"甲":"寅","乙":"寅","丙":"巳","丁":"巳","戊":"巳","己":"巳","庚":"申","辛":"申","壬":"亥","癸":"亥"};function p(t){if(!t)return 0;return(6*c.indexOf(t[0])-5*m.indexOf(t[1])+60)%60+1}function y(t,i){const n=c.indexOf(t[0]),e=m.indexOf(t[1]);for(let s=0;s<10;s++){const t=m[(e+s)%12];if(t===i){return c[(n+s)%10]+t}}return""}function G(t,i,n){let e=i-1,s=t;for(let o=0;o<e;o++)s=n?s%9+1:1===s?9:s-1;return s}function z(t){const{monthGz:i,dayGz:n,isYang:e,mainYuejianGong:s,guestYuejianGong:o}=t;p(n);const a=i[1],r=f[a],h=function(t){const i=c.indexOf(t[0]),n=m.indexOf(t[1]);return"甲"+m[(n-i+12)%12]}(n),u=y(h,r),g=p(u),l=G(s,g,e),z=G(o,g,!e),S=u[0],x=y(h,d[S]),j=p(x),I=G(s,j,e),b=G(o,j,!e),T=(t,i,n)=>{for(let e=0;e<9;e++){if(((i+e-1)%9+9)%9+1===t){return G(5,e+1,n)}}return-1};return{trueGeneralStar:u,mainGeneralGong:l,guestGeneralGong:z,wangQiYao:x,mainWangGong:I,guestWangGong:b,mainSuperPos:T(l,I,e),guestSuperPos:T(z,b,!e)}}const S=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],x=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],j=["","天蓬","天芮","天冲","天辅","天禽","天心","天柱","天任","天英"],I=["冬至","小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种"],b={"冬至":[1,7,4],"小寒":[2,8,5],"大寒":[3,9,6],"立春":[8,5,2],"雨水":[9,6,3],"惊蛰":[1,7,4],"春分":[3,9,6],"清明":[4,1,7],"谷雨":[5,2,8],"立夏":[4,1,7],"小满":[5,2,8],"芒种":[6,3,9],"夏至":[9,3,6],"小暑":[8,2,5],"大暑":[7,1,4],"立秋":[2,5,8],"处暑":[1,4,7],"白露":[9,3,6],"秋分":[7,1,4],"寒露":[6,3,9],"霜降":[5,2,8],"立冬":[6,3,9],"小雪":[5,2,8],"大雪":[4,1,7]},T={"甲子":"海中金","乙丑":"海中金","丙寅":"炉中火","丁卯":"炉中火","戊辰":"大林木","己巳":"大林木","庚午":"路旁土","辛未":"路旁土","壬申":"剑锋金","癸酉":"剑锋金","甲戌":"山头火","乙亥":"山头火","丙子":"涧下水","丁丑":"涧下水","戊寅":"城头土","己卯":"城头土","庚辰":"白蜡金","辛巳":"白蜡金","壬午":"杨柳木","癸未":"杨柳木","甲申":"泉中水","乙酉":"泉中水","丙戌":"屋上土","丁亥":"屋上土","戊子":"霹雳火","己丑":"霹雳火","庚寅":"松柏木","辛卯":"松柏木","壬辰":"长流水","癸巳":"长流水","甲午":"沙中金","乙未":"沙中金","丙申":"山下火","丁酉":"山下火","戊戌":"平地木","己亥":"平地木","庚子":"壁上土","辛丑":"壁上土","壬寅":"金箔金","癸卯":"金箔金","甲辰":"佛灯火","乙巳":"佛灯火","丙午":"天河水","丁未":"天河水","戊申":"大驿土","己酉":"大驿土","庚戌":"钗钏金","辛亥":"钗钏金","壬子":"桑柘木","癸丑":"桑柘木","甲寅":"大溪水","乙卯":"大溪水","丙辰":"沙中土","丁巳":"沙中土","戊午":"天上火","己未":"天上火","庚申":"石榴木","辛酉":"石榴木","壬戌":"大海水","癸亥":"大海水"},D=t=>T[t]||"",X={"冬至":{"上候":1,"中候":7,"下候":4},"立春":{"上候":8,"中候":5,"下候":2},"春分":{"上候":3,"中候":9,"下候":6},"立夏":{"上候":4,"中候":1,"下候":7},"夏至":{"上候":9,"中候":3,"下候":6},"立秋":{"上候":2,"中候":5,"下候":8},"秋分":{"上候":7,"中候":1,"下候":4},"立冬":{"上候":6,"中候":3,"下候":9}},N={"小寒":{"上候":2,"中候":8,"下候":5},"雨水":{"上候":9,"中候":6,"下候":3},"清明":{"上候":4,"中候":1,"下候":7},"小满":{"上候":5,"中候":2,"下候":8},"小暑":{"上候":8,"中候":2,"下候":5},"处暑":{"上候":1,"中候":4,"下候":7},"寒露":{"上候":6,"中候":9,"下候":3},"小雪":{"上候":5,"中候":8,"下候":2}},w={"大寒":{"上候":3,"中候":9,"下候":6},"惊蛰":{"上候":1,"中候":7,"下候":4},"谷雨":{"上候":5,"中候":2,"下候":8},"芒种":{"上候":6,"中候":3,"下候":9},"大暑":{"上候":9,"中候":1,"下候":4},"白露":{"上候":6,"中候":3,"下候":6},"霜降":{"上候":7,"中候":1,"下候":4},"大雪":{"上候":7,"中候":1,"下候":1}};function B(t){if(!t||t.length<2)return 1;const i=t[0],n=t[1],e=S.indexOf(i),s=x.indexOf(n);if(-1===e||-1===s)return 1;for(let o=0;o<60;o++){const t=S[o%10],e=x[o%12];if(t===i&&e===n)return o+1}return 1}function O(t,i,n){let e=t;const s=(i-1)%9;for(let o=0;o<s;o++)e=n?e%9+1:1===e?9:e-1;return e}function C(t){if(!t||t.length<2)return"";const i=t.charAt(0),n=t.charAt(1),e=S.indexOf(i),s=x.indexOf(n);if(-1===e||-1===s)return"";const o=(s-e+12)%12;return x[(o+10)%12]+x[(o+11)%12]}function k(t,i,n={}){const e=new Date(`${t}T${i}:00`),s=g.Solar.fromDate(e);let o={};if(n&&n.bazi)o=n.bazi;else{const t=u(e,n.huoshiShichen);if(!t)return{error:"四柱计算失败"};o={year:t.year,month:t.month,day:t.day,hour:t.hour}}let a="",r=0,h=!1;if(n&&n.jieqi&&n.bazi){a=n.jieqi,h=I.includes(a);const t=n.bazi.day,i=t.charAt(0),e=t.charAt(1),s=S.indexOf(i),o=x.indexOf(e),u=x[(o-s%5+12)%12];r=["子","午","卯","酉"].includes(u)?0:["寅","申","巳","亥"].includes(u)?1:2}else{let t=s.getLunar().getPrevJieQi(!0);if(!t)return{error:"日期超出范围"};a=t.getName();const i=t.getSolar(),n=(e.getTime()-new Date(i.toYmdHms()).getTime())/36e5,o=Math.floor(n/120);r=o>=2?2:o,h=I.includes(a)}let l=0;if(n&&n.ju)h=n.ju.isYang,l=n.ju.juNum,a||(a="手工");else{const t=b[a];if(!t)return{error:"未知节气: "+a};l=t[r]}const c=["上候","中候","下候"][r],m=(d=c,X[f=a]?X[f][d]||1:N[f]?N[f][d]||1:w[f]&&w[f][d]||1);var f,d;const p=B(o.year),y=O(m,p,h),G=B(o.month),T=O(y,G,h),k=B(o.day),v=O(T,k,h),Y=B(o.hour),$=O(v,Y,h);let A=10-m;5===m&&(A=8);const Z=!h,M=O(A,p,Z),P=O(M,G,Z),_=O(P,k,Z),H=O(_,Y,Z),R=["戊","己","庚","辛","壬","癸","丁","丙","乙"],F=new Array(10).fill("");for(let u=0;u<9;u++){let t=0;if(h)t=(l+u-1)%9+1;else{let i=l-u;for(;i<=0;)i+=9;for(;i>9;)i-=9;t=i}F[t]=R[u]}const U=new Array(10).fill("");for(let u=1;u<=9;u++){let t;Z?(t=(5+u-$+9)%9,0===t&&(t=9)):(t=(5-u+$+9)%9,0===t&&(t=9)),U[t]=j[u]}const q=U[v],E=t=>{const i=j.indexOf(t);return i>0?F[i]:""},L=q+" "+E(q),Q=j[$],W=new Array(10).fill("");for(let u=1;u<=9;u++){let t;h?(t=(5+u-$+9)%9,0===t&&(t=9)):(t=(5-u+$+9)%9,0===t&&(t=9)),W[t]=j[u]}const J=W[v],K=J+" "+E(J),V=v;let tt=0;for(let u=1;u<=9;u++)if(W[u]===q){tt=u;break}const it=new Array(10).fill("");for(let u=1;u<=9;u++){const t=W[u],i=j.indexOf(t);i>0&&(it[u]=F[i])}const nt={year:{gz:o.year,xk:C(o.year),ny:D(o.year)},month:{gz:o.month,xk:C(o.month),ny:D(o.month)},day:{gz:o.day,xk:C(o.day),ny:D(o.day)},hour:{gz:o.hour,xk:C(o.hour),ny:D(o.hour)}},et={};for(let u=1;u<=9;u++)et[u]={star:W[u],earthStem:F[u],skyStem:it[u],isTaisui:u===y,isYuejian:u===T,isRijian:u===v,isShijian:u===$};const st=z({monthGz:o.month,dayGz:o.day,isYang:h,mainYuejianGong:T,guestYuejianGong:P});return{jieQi:a,yuan:["上元","中元","下元"][r],hou:c,juName:(h?"阳遁":"阴遁")+["一","二","三","四","五","六","七","八","九"][l-1]+"局",bazi:o,startGong:m,taisuiGong:y,yuejianGong:T,rijianGong:v,shijianGong:$,guestTaisuiGong:M,guestYuejianGong:P,guestRijianGong:_,guestShijianGong:H,zhiFu:Q,zhuXing:K,guestZhuXing:L,mainStarPos:V,guestStarPos:tt,wufu:st,layout:{baziInfo:nt,gongInfo:et,earth:F,stars:W,skyStem:it}}}const v=l({data:()=>({options:{},result:{jieQi:"",yuan:"",juName:"",bazi:{year:"",month:"",day:"",hour:""},zhiFu:"",zhuXing:"",startGong:0,taisuiGong:0,yuejianGong:0,rijianGong:0,shijianGong:0,layout:{baziInfo:null,gongInfo:null,earth:[],stars:[],skyStem:[],fiveShaMap:{}}},gridLayout:[[4,9,2],[3,5,7],[8,1,6]],xingnianBenming:null,xingnianBenming2:null,gangXingInfo:null,customDateTime:null,useCustomTime:!1,timer:null}),onLoad(i){this.options=i,(i.datetime||"custom"===i.mode||"sizhu"===i.mode||"manual"===i.mode)&&(this.useCustomTime=!0,i.datetime&&(this.customDateTime=decodeURIComponent(i.datetime)));try{if(this.options.datetime&&(!this.options.date||!this.options.time)){const t=new Date(decodeURIComponent(this.options.datetime));this.options.date=this.formatDate(t),this.options.time=this.formatTime(t)}this.calc(),this.useCustomTime||(this.timer=setInterval((()=>{this.calc()}),1e3))}catch(n){console.error("onLoad Error:",n),t({title:"加载出错",icon:"none"})}},onUnload(){this.timer&&clearInterval(this.timer)},methods:{goBack(){i()},goPrevious(){let t;this.timer&&clearInterval(this.timer),this.timer=null,t=this.useCustomTime&&this.customDateTime?new Date(this.customDateTime):this.options.date&&this.options.time?new Date(`${this.options.date}T${this.options.time}:00`):new Date,t.setHours(t.getHours()-2),this.customDateTime=t.toISOString(),this.useCustomTime=!0,this.options.mode="custom",this.options.date=this.formatDate(t),this.options.time=this.formatTime(t),this.calc()},goCurrentTime(){this.customDateTime=null,this.useCustomTime=!1,this.options.mode="current",this.options.date=null,this.options.time=null,this.calc(),this.timer&&clearInterval(this.timer),this.timer=setInterval((()=>{this.calc()}),1e3)},goNext(){let t;this.timer&&clearInterval(this.timer),this.timer=null,t=this.useCustomTime&&this.customDateTime?new Date(this.customDateTime):this.options.date&&this.options.time?new Date(`${this.options.date}T${this.options.time}:00`):new Date,t.setHours(t.getHours()+2),this.customDateTime=t.toISOString(),this.useCustomTime=!0,this.options.mode="custom",this.options.date=this.formatDate(t),this.options.time=this.formatTime(t),this.calc()},calc(){try{let n,e,s={};if("current"!==this.options.mode&&"current-time"!==this.options.mode&&this.options.mode){if("custom"===this.options.mode||"huoshi"===this.options.mode||"time"===this.options.mode){if(n=this.options.date,e=this.options.time,!n||!e){const t=new Date;n=this.formatDate(t),e=this.formatTime(t)}}else if("sizhu"===this.options.mode){if(n="2000-01-01",e="12:00",this.options.bazi){const t=decodeURIComponent(this.options.bazi).split(","),i=decodeURIComponent(this.options.jieqi);s.bazi={year:t[0],month:t[1],day:t[2],hour:t[3]},s.jieqi=i}}else if("manual"===this.options.mode){const t=new Date;n=this.formatDate(t),e=this.formatTime(t)}}else{const t=new Date;n=this.formatDate(t),e=this.formatTime(t)}if(this.options.ju){const t=this.options.ju.split("-");2===t.length&&(s.ju={isYang:"yang"===t[0],juNum:parseInt(t[1])})}if(1==this.options.method&&this.options.huoshiShichen){const t=this.options.huoshiShichen,i={"子":"00:00","丑":"02:00","寅":"04:00","卯":"06:00","辰":"08:00","巳":"10:00","午":"12:00","未":"14:00","申":"16:00","酉":"18:00","戌":"20:00","亥":"22:00"};i[t]&&(e=i[t],s.isHuoshi=!0,s.huoshiNumber=this.options.huoshiNumber,s.huoshiShichen=t)}const o=k(n,e,s);if(o.error)return void t({title:o.error,icon:"none"});if(this.result=o,this.options.birthYear)try{const t=this.calcZezhongBenMingXingNian(this.options.birthYear,new Date(n),this.result.layout);if(this.xingnianBenming=t,t.benMingGong&&t.xingNianGong){const i=t.benMingGong,n=t.xingNianGong;this.result.layout.gongInfo[i]&&this.$set(this.result.layout.gongInfo[i],"isBenMing",!0),this.result.layout.gongInfo[n]&&this.$set(this.result.layout.gongInfo[n],"isXingNian",!0)}}catch(i){console.error("XingNian Calc Error",i)}const a=this.xingnianBenming?this.xingnianBenming.benMingGong:0;if(this.gangXingInfo=this.calcGangXingInfo(this.result.layout.baziInfo,a),this.result.layout.gangXingZhi&&this.gangXingInfo&&(this.$set(this.gangXingInfo,"gangXing",this.result.layout.gangXingZhi),this.$set(this.gangXingInfo,"gangXingPalace",this.getGongName(this.result.layout.gangXingGong))),this.xingnianBenming&&this.xingnianBenming.benming){const t=this.xingnianBenming.benming.zhi;this.$set(this.result.layout,"fiveShaMap",this.calcFiveSha(t))}if(this.result.layout.gangXingGong){const t=this.result.layout.gangXingGong;this.result.layout.gongInfo[t]&&this.$set(this.result.layout.gongInfo[t],"isGangXing",!0)}}catch(i){console.error("Calc Error:",i),t({title:"排盘计算出错",icon:"none"})}},formatDate:t=>`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`,formatTime(t){if(!t||isNaN(t.getTime()))return"00:00";return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},getGongName:t=>["","坎","坤","震","巽","中","乾","兑","艮","离"][t],getGongInfo(t){return this.result.layout.gongInfo&&this.result.layout.gongInfo[t]?this.result.layout.gongInfo[t]:{star:"",earthStem:"",skyStem:"",isTaisui:!1,isYuejian:!1,isRijian:!1,isShijian:!1}},getGan:t=>!t||t.length<1?"":t.charAt(0),getZhi:t=>!t||t.length<2?"":t.charAt(1),getXunKong(t){if(!t||t.length<2)return"";const i=t.charAt(0),n=t.charAt(1),e=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],s=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"].indexOf(i),o=e.indexOf(n);if(-1===s||-1===o)return"";const a=(o-s+12)%12,r=(a-1+12)%12;return e[(a-2+12)%12]+e[r]},getWuXingClass:t=>t?"甲乙寅卯震巽木".includes(t)?"wx-wood":"丙丁巳午离火".includes(t)?"wx-fire":"戊己辰戌丑未坤艮土".includes(t)?"wx-earth":"庚辛申酉乾兑金".includes(t)?"wx-metal":"壬癸亥子坎水".includes(t)?"wx-water":"":"",getNaYinColor(t){if(!t)return"";const i=t.slice(-1);return this.getWuXingClass(i)},getGongByZhi:t=>({"子":1,"丑":8,"寅":8,"卯":3,"辰":4,"巳":4,"午":9,"未":2,"申":2,"酉":7,"戌":6,"亥":6}[t]||0),calcGangXingInfo(t,i=0){if(!t||!t.year||!t.month)return null;const n=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],e=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],s=this.getZhi(t.month.gz),o=e.indexOf(s);if(-1===o)return null;const a=(5-o+12)%12,r=e[a],h=this.getZhi(t.year.gz),u=this.getGongByZhi(h),g=(a-2+12)%12+1,l=this.getGan(t.year.gz),c="甲丙戊庚壬".includes(l)?1:-1;let m=(u-1+(g-1)*c)%9;m<0&&(m+=9);const f=m+1,d=this.getGongName(f),p=(a-4+12)%12,y=e[p],G=n.indexOf(l),z=n[(p-(e.indexOf(h)-G+12)%12+12)%12%10],S=z+y;let x=-1;for(let I=0;I<60;I++){const t=n[I%10],i=e[I%12];if(t===z&&i===y){x=I;break}}let j=S;if(-1!==x&&i>0){let t=(i-1+x*c)%9;t<0&&(t+=9);const n=t+1;return j+=" ("+this.getGongName(n)+"宫)",{gangXing:r,gangXingPalace:d,zhenSha:y,zhenShaBenSui:j,zsBenSuiGan:z,zsBenSuiZhi:y,zsBenSuiPalace:this.getGongName(n)}}return{gangXing:r,gangXingPalace:d,zhenSha:y,zhenShaBenSui:j,zsBenSuiGan:z,zsBenSuiZhi:y,zsBenSuiPalace:""}},calcZezhongBenMingXingNian(t,i,n){try{const e=parseInt(t),s=i.getFullYear();if(isNaN(e)||isNaN(s))return null;const o=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],a=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];let r=e-1984,h=r%10;h<0&&(h+=10);let u=r%12;u<0&&(u+=12);const g=o[h],l=a[u],c=g+l,m={"戊":["甲子","癸酉","壬午","辛卯","庚子","己酉","戊午"],"己":["乙丑","甲戌","癸未","壬辰","辛丑","庚戌","己未"],"庚":["丙寅","乙亥","甲申","癸巳","壬寅","辛亥","庚申"],"辛":["丁卯","丙子","乙酉","甲午","癸卯","壬子","辛酉"],"壬":["戊辰","丁丑","丙戌","乙未","甲辰","癸丑","壬戌"],"癸":["己巳","戊寅","丁亥","丙申","乙巳","甲寅","癸亥"],"丁":["庚午","己卯","戊子","丁酉","丙午","乙卯"],"丙":["辛未","庚辰","己丑","戊戌","丁未","丙辰"],"乙":["壬申","辛巳","庚寅","己亥","戊申","丁巳"]};let f="";for(const t in m)if(m[t].includes(c)){f=t;break}let d=0;if(f&&n&&n.gongInfo){for(let t=1;t<=9;t++){const i=n.gongInfo[t];if(i&&i.skyStem===f){d=t;break}}if(0===d)for(let t=1;t<=9;t++){const i=n.gongInfo[t];if(i&&i.earthStem===f){d=t;break}}}const p=s-e+1;let y=s-1984,G=y%10;G<0&&(G+=10);let z=y%12;z<0&&(z+=12);const S=o[G],x=a[z];let j=0;if(d>0){const t=p-1;let i=(d-1+(-1!==(this.result.juName||"").indexOf("阳")?t:-t))%9;i<0&&(i+=9),j=i+1}return{birthYear:e,benming:{gan:g,zhi:l},xingnian:{gan:S,zhi:x},benMingGong:d,xingNianGong:j}}catch(e){return console.error("Zezhong Age Calc Error",e),null}},calcFiveSha(t){if(!t)return{};let i=null;if("申子辰".includes(t)?i={musha:"辰",jiesha:"巳",zaisha:"午",tiansha:"未",disha:"申"}:"寅午戌".includes(t)?i={musha:"戌",jiesha:"亥",zaisha:"子",tiansha:"丑",disha:"寅"}:"亥卯未".includes(t)?i={musha:"未",jiesha:"申",zaisha:"酉",tiansha:"戌",disha:"亥"}:"巳酉丑".includes(t)&&(i={musha:"丑",jiesha:"寅",zaisha:"卯",tiansha:"辰",disha:"巳"}),!i)return{};const n={};for(const e in i){const t=i[e];n[t]||(n[t]=[]);const s={musha:"墓煞",jiesha:"劫煞",zaisha:"灾煞",tiansha:"天煞",disha:"地煞"}[e];n[t].push(s)}return n}}},[["render",function(t,i,u,g,l,c){const m=h,f=s;return o(),n(f,{class:"container"},{default:e((()=>[a(f,{class:"nav-bar"},{default:e((()=>[a(f,{class:"back-btn",onClick:t.goHome},{default:e((()=>[a(m,{class:"back-icon"},{default:e((()=>[r("‹")])),_:1}),a(m,{class:"back-text"},{default:e((()=>[r("返回")])),_:1})])),_:1},8,["onClick"]),a(f,{class:"nav-title"},{default:e((()=>[r("遁甲折衷排盘")])),_:1}),a(f,{class:"placeholder"})])),_:1}),a(f,{class:"content"})])),_:1})}],["__scopeId","data-v-d77ae149"]]);export{v as default};
