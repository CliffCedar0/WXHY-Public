const t=[19416,19168,42352,21717,53856,55632,91476,22176,39632,21970,19168,42422,42192,53840,119381,46400,54944,44450,38320,84343,18800,42160,46261,27216,27968,109396,11104,38256,21234,18800,25958,54432,59984,28309,23248,11104,100067,37600,116951,51536,54432,120998,46416,22176,107956,9680,37584,53938,43344,46423,27808,46416,86869,19872,42448,83315,21200,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46496,103846,38320,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,21952,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,86390,21168,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19415,19152,42192,118966,53840,54560,56645,46496,22224,21938,18864,42359,42160,43600,111189,27936,44448];function e(e){let r,a=348;for(r=32768;r>8;r>>=1)a+=t[e-1900]&r?1:0;return a+n(e)}function n(e){return r(e)?65536&t[e-1900]?30:29:0}function r(e){return 15&t[e-1900]}let a,o;try{const t=require("lunar-javascript");a=t.Solar,o=t.Lunar}catch(s){console.warn("lunar-javascript 库未安装，将使用简化计算")}const u=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],h=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];function c(t,e){const n=u.indexOf(t),r=h.indexOf(e);return u[(n%5*2+r)%10]}function l(t,e){const n=function(t,e){if(!a||!o)return null;try{const n=t.getHours();let r=new Date(t);n>=23&&r.setDate(r.getDate()+1);const o=a.fromDate(t).getLunar(),u=a.fromDate(r).getLunar(),h=o.getYearInGanZhi(),l=o.getMonthInGanZhi(),i=u.getDayInGanZhi();let s;return s=e?c(i.charAt(0),e)+e:o.getTimeInGanZhi(),{year:h,month:l,day:i,hour:s,yearGan:h.charAt(0),yearZhi:h.charAt(1),monthGan:l.charAt(0),monthZhi:l.charAt(1),dayGan:i.charAt(0),dayZhi:i.charAt(1),hourGan:s.charAt(0),hourZhi:s.charAt(1)}}catch(s){return console.error("lunar-javascript 计算四柱失败:",s),null}}(t,e);return n||(console.warn("使用简化四柱计算，结果可能不够精确。请安装 lunar-javascript 库：npm install lunar-javascript"),function(t,e){const n=t.getFullYear(),r=t.getMonth()+1,a=t.getHours();let o=new Date(t);a>=23&&o.setDate(o.getDate()+1);const l=n-1984;let i=l%10,s=l%12;i<0&&(i+=10),s<0&&(s+=12);const f=u[i],g=h[s],y=(r+1)%12,m=u.indexOf(f)%5,D=u[((2*m+2)%10+r-1)%10],d=h[y],Z=new Date(2e3,0,7),G=Math.floor((o-Z)/864e5);let M=G%10,A=G%12;M<0&&(M+=10),A<0&&(A+=12);const $=u[M],p=h[A],N=e||h[Math.floor((a+1)/2)%12],w=c($,N);return{year:f+g,month:D+d,day:$+p,hour:w+N,yearGan:f,yearZhi:g,monthGan:D,monthZhi:d,dayGan:$,dayZhi:p,hourGan:w,hourZhi:N}}(t,e))}function i(c){if(a&&o)try{const t=c.getHours();let e=new Date(c);t>=23&&e.setDate(e.getDate()+1);const n=a.fromDate(e).getLunar(),r=n.getYearZhi(),o=h.indexOf(r)+1,u=Math.abs(n.getMonth()),l=n.getDay(),i=n.getTimeZhi();return{yearNum:o,monthNum:u,dayNum:l,hourNum:h.indexOf(i)+1,lunarStr:`${n.getYearInGanZhi()}年 ${n.getMonthInChinese()}月${n.getDayInChinese()} ${i}时`}}catch(s){console.error("Lunar lib error, using fallback:",s)}try{const a=c.getHours();let o=new Date(c);a>=23&&o.setDate(o.getDate()+1);const s=function(a){let o,u,h,c,l=0,i=0,s=(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate())-Date.UTC(1900,0,31))/864e5;if(s<0)return null;for(o=1900;o<2050&&s>0;o++)i=e(o),s-=i;s<0&&(s+=i,o--),u=o,l=r(o);let f=!1;for(o=1;o<13&&s>0;o++)l>0&&o===l+1&&!f?(--o,f=!0,i=n(u)):i=t[u-1900]&65536>>o?30:29,f&&o===l+1&&(f=!1),s-=i;return 0===s&&l>0&&o===l+1&&(f?f=!1:(f=!0,--o)),s<0&&(s+=i,--o),h=o,c=s+1,{year:u,month:h,day:c,isLeap:f}}(o);if(!s)return null;const f=(s.year-4)%12+1,g=(s.year-4)%10,y=u[g],m=h[f-1],D=s.month,d=s.day,Z=Math.floor((a+1)/2)%12,G=Z+1,M=h[Z];return{yearNum:f,monthNum:D,dayNum:d,hourNum:G,lunarStr:`${y}${m}年 ${i=D,["正","二","三","四","五","六","七","八","九","十","冬","腊"][i-1]}月${l=d,10===l?"初十":20===l?"二十":30===l?"三十":["初","十","廿","三"][Math.floor(l/10)]+["十","一","二","三","四","五","六","七","八","九"][l%10]} ${M}时`}}catch(s){return console.error("Fallback lunar calculation error:",s),null}var l,i}export{i as a,l as g};
