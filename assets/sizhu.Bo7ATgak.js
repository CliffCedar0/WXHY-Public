import{L as n}from"./lunar_lib.DCJsrIrZ.js";const t=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],a={"雨水":"亥","惊蛰":"亥","春分":"戌","清明":"戌","谷雨":"酉","立夏":"酉","小满":"申","芒种":"申","夏至":"未","小暑":"未","大暑":"午","立秋":"午","处暑":"巳","白露":"巳","秋分":"辰","寒露":"辰","霜降":"卯","立冬":"卯","小雪":"寅","大雪":"寅","冬至":"丑","小寒":"丑","大寒":"子","立春":"子"};function e(n){const t=n.getMonth()+1,a=n.getDate(),e=[{name:"小寒",month:1,day:6},{name:"大寒",month:1,day:20},{name:"立春",month:2,day:4},{name:"雨水",month:2,day:19},{name:"惊蛰",month:3,day:6},{name:"春分",month:3,day:21},{name:"清明",month:4,day:5},{name:"谷雨",month:4,day:20},{name:"立夏",month:5,day:6},{name:"小满",month:5,day:21},{name:"芒种",month:6,day:6},{name:"夏至",month:6,day:21},{name:"小暑",month:7,day:7},{name:"大暑",month:7,day:23},{name:"立秋",month:8,day:8},{name:"处暑",month:8,day:23},{name:"白露",month:9,day:8},{name:"秋分",month:9,day:23},{name:"寒露",month:10,day:8},{name:"霜降",month:10,day:24},{name:"立冬",month:11,day:8},{name:"小雪",month:11,day:22},{name:"大雪",month:12,day:7},{name:"冬至",month:12,day:22}];let r="冬至";for(let o=0;o<e.length;o++){const n=e[o];if(t<n.month||t===n.month&&a<n.day)break;r=n.name}return r}function r(n){return a[n]||"子"}function o(n,a){const e=t.indexOf(n),r=t.indexOf(a),o={};for(let h=0;h<12;h++){const n=(e+h-r+12)%12;o[t[h]]=t[n]}return o}function h(n,t){const a=e(n),h=r(a);return{jieqi:a,yuejiang:h,tianpan:o(h,t),shichen:t}}const i=[19416,19168,42352,21717,53856,55632,91476,22176,39632,21970,19168,42422,42192,53840,119381,46400,54944,44450,38320,84343,18800,42160,46261,27216,27968,109396,11104,38256,21234,18800,25958,54432,59984,28309,23248,11104,100067,37600,116951,51536,54432,120998,46416,22176,107956,9680,37584,53938,43344,46423,27808,46416,86869,19872,42448,83315,21200,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46496,103846,38320,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,21952,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,86390,21168,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19415,19152,42192,118966,53840,54560,56645,46496,22224,21938,18864,42359,42160,43600,111189,27936,44448];function u(n){let t,a=348;for(t=32768;t>8;t>>=1)a+=i[n-1900]&t?1:0;return a+m(n)}function m(n){return c(n)?65536&i[n-1900]?30:29:0}function c(n){return 15&i[n-1900]}const{Solar:l,Lunar:y}=n,s=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],d=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];function g(n,t){const a=s.indexOf(n),e=d.indexOf(t);return s[(a%5*2+e)%10]}function f(n,t){if(!l||!y)return null;try{const a=n.getHours();let e=new Date(n);a>=23&&e.setDate(e.getDate()+1);const r=l.fromDate(n).getLunar(),o=l.fromDate(e).getLunar();let h,i,u,m;if(r.getBaZiYearGanZhi?(h=r.getBaZiYearGanZhi(),i=r.getBaZiMonthGanZhi(),u=r.getBaZiDayGanZhi(),m=r.getBaZiHourGanZhi()):(h=r.getYearInGanZhiByLiChun?r.getYearInGanZhiByLiChun():r.getYearInGanZhi(),i=r.getMonthInGanZhiExact?r.getMonthInGanZhiExact():r.getMonthInGanZhi(),u=o.getDayInGanZhi(),m=r.getTimeInGanZhi()),t){m=g(u.charAt(0),t)+t}return{year:h,month:i,day:u,hour:m,yearGan:h.charAt(0),yearZhi:h.charAt(1),monthGan:i.charAt(0),monthZhi:i.charAt(1),dayGan:u.charAt(0),dayZhi:u.charAt(1),hourGan:m.charAt(0),hourZhi:m.charAt(1)}}catch(a){return console.error("lunar-javascript 计算四柱失败:",a),null}}function Z(n,t){const a=f(n,t);return a||(console.warn("使用简化四柱计算，结果可能不够精确。请安装 lunar-javascript 库：npm install lunar-javascript"),function(n,t){let a=n.getFullYear();n.getMonth(),n.getDate();const r=n.getHours();let o=new Date(n);r>=23&&o.setDate(o.getDate()+1);const h=e(n);["小寒","大寒","冬至"].includes(h)&&(a-=1);const i=a-1984;let u=i%10,m=i%12;u<0&&(u+=10),m<0&&(m+=12);const c=s[u],l=d[m];let y={"立春":"寅","雨水":"寅","惊蛰":"卯","春分":"卯","清明":"辰","谷雨":"辰","立夏":"巳","小满":"巳","芒种":"午","夏至":"午","小暑":"未","大暑":"未","立秋":"申","处暑":"申","白露":"酉","秋分":"酉","寒露":"戌","霜降":"戌","立冬":"亥","小雪":"亥","大雪":"子","冬至":"子","小寒":"丑","大寒":"丑"}[h]||"寅",f=d.indexOf(y);const Z=s.indexOf(c)%5,D=s[((2*Z+2)%10+(f-2+12)%12)%10],G=new Date(2e3,0,7),M=Math.floor((o-G)/864e5);let x=M%10,I=M%12;x<0&&(x+=10),I<0&&(I+=12);const A=s[x],L=d[I],Y=t||d[Math.floor((r+1)/2)%12],$=g(A,Y);return{year:c+l,month:D+y,day:A+L,hour:$+Y,yearGan:c,yearZhi:l,monthGan:D,monthZhi:y,dayGan:A,dayZhi:L,hourGan:$,hourZhi:Y}}(n,t))}function D(n){if(l&&y)try{const t=n.getHours();let a=new Date(n);t>=23&&a.setDate(a.getDate()+1);const e=l.fromDate(a).getLunar(),r=e.getYearZhi(),o=d.indexOf(r)+1,h=Math.abs(e.getMonth()),i=e.getDay(),u=e.getTimeZhi();return{yearNum:o,monthNum:h,dayNum:i,hourNum:d.indexOf(u)+1,lunarStr:`${e.getYearInGanZhi()}年 ${e.getMonthInChinese()}月${e.getDayInChinese()} ${u}时`}}catch(e){console.error("Lunar lib error, using fallback:",e)}try{const e=n.getHours();let r=new Date(n);e>=23&&r.setDate(r.getDate()+1);const o=function(n){let t,a,e,r,o=0,h=0,l=(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())-Date.UTC(1900,0,31))/864e5;if(l<0)return null;for(t=1900;t<2050&&l>0;t++)h=u(t),l-=h;l<0&&(l+=h,t--),a=t,o=c(t);let y=!1;for(t=1;t<13&&l>0;t++)o>0&&t===o+1&&!y?(--t,y=!0,h=m(a)):h=i[a-1900]&65536>>t?30:29,y&&t===o+1&&(y=!1),l-=h;return 0===l&&o>0&&t===o+1&&(y?y=!1:(y=!0,--t)),l<0&&(l+=h,--t),e=t,r=l+1,{year:a,month:e,day:r,isLeap:y}}(r);if(!o)return null;const h=(o.year-4)%12+1,l=(o.year-4)%10,y=s[l],g=d[h-1],f=o.month,Z=o.day,D=Math.floor((e+1)/2)%12,G=D+1,M=d[D];return{yearNum:h,monthNum:f,dayNum:Z,hourNum:G,lunarStr:`${y}${g}年 ${a=f,["正","二","三","四","五","六","七","八","九","十","冬","腊"][a-1]}月${t=Z,10===t?"初十":20===t?"二十":30===t?"三十":["初","十","廿","三"][Math.floor(t/10)]+["十","一","二","三","四","五","六","七","八","九"][t%10]} ${M}时`}}catch(e){return console.error("Fallback lunar calculation error:",e),null}var t,a}export{Z as a,D as b,f as c,o as d,r as e,h as g};
