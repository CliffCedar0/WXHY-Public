import{l as n}from"./index.BHYqNsFk.js";const t=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],a={"雨水":"亥","惊蛰":"亥","春分":"戌","清明":"戌","谷雨":"酉","立夏":"酉","小满":"申","芒种":"申","夏至":"未","小暑":"未","大暑":"午","立秋":"午","处暑":"巳","白露":"巳","秋分":"辰","寒露":"辰","霜降":"卯","立冬":"卯","小雪":"寅","大雪":"寅","冬至":"丑","小寒":"丑","大寒":"子","立春":"子"};function e(n){const t=n.getMonth()+1,a=n.getDate(),e=[{name:"小寒",month:1,day:6},{name:"大寒",month:1,day:20},{name:"立春",month:2,day:4},{name:"雨水",month:2,day:19},{name:"惊蛰",month:3,day:6},{name:"春分",month:3,day:21},{name:"清明",month:4,day:5},{name:"谷雨",month:4,day:20},{name:"立夏",month:5,day:6},{name:"小满",month:5,day:21},{name:"芒种",month:6,day:6},{name:"夏至",month:6,day:21},{name:"小暑",month:7,day:7},{name:"大暑",month:7,day:23},{name:"立秋",month:8,day:8},{name:"处暑",month:8,day:23},{name:"白露",month:9,day:8},{name:"秋分",month:9,day:23},{name:"寒露",month:10,day:8},{name:"霜降",month:10,day:24},{name:"立冬",month:11,day:8},{name:"小雪",month:11,day:22},{name:"大雪",month:12,day:7},{name:"冬至",month:12,day:22}];let r="冬至";for(let o=0;o<e.length;o++){const n=e[o];if(t<n.month||t===n.month&&a<n.day)break;r=n.name}return r}function r(n){return a[n]||"子"}function o(n,a){const e=t.indexOf(n),r=t.indexOf(a),o={};for(let h=0;h<12;h++){const n=(e+h-r+12)%12;o[t[h]]=t[n]}return o}function h(n,t){const a=e(n),h=r(a);return{jieqi:a,yuejiang:h,tianpan:o(h,t),shichen:t}}const i=[19416,19168,42352,21717,53856,55632,91476,22176,39632,21970,19168,42422,42192,53840,119381,46400,54944,44450,38320,84343,18800,42160,46261,27216,27968,109396,11104,38256,21234,18800,25958,54432,59984,28309,23248,11104,100067,37600,116951,51536,54432,120998,46416,22176,107956,9680,37584,53938,43344,46423,27808,46416,86869,19872,42448,83315,21200,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46496,103846,38320,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,21952,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,86390,21168,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19415,19152,42192,118966,53840,54560,56645,46496,22224,21938,18864,42359,42160,43600,111189,27936,44448];function u(n){let t,a=348;for(t=32768;t>8;t>>=1)a+=i[n-1900]&t?1:0;return a+m(n)}function m(n){return c(n)?65536&i[n-1900]?30:29:0}function c(n){return 15&i[n-1900]}function s(n){let t,a,e,r,o=0,h=0,s=(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())-Date.UTC(1900,0,31))/864e5;if(s<0)return null;for(t=1900;t<2050&&s>0;t++)h=u(t),s-=h;s<0&&(s+=h,t--),a=t,o=c(t);let l=!1;for(t=1;t<13&&s>0;t++)o>0&&t===o+1&&!l?(--t,l=!0,h=m(a)):h=i[a-1900]&65536>>t?30:29,l&&t===o+1&&(l=!1),s-=h;return 0===s&&o>0&&t===o+1&&(l?l=!1:(l=!0,--t)),s<0&&(s+=h,--t),e=t,r=s+1,{year:a,month:e,day:r,isLeap:l}}function l(n){return["正","二","三","四","五","六","七","八","九","十","冬","腊"][n-1]}function y(n){return 10===n?"初十":20===n?"二十":30===n?"三十":["初","十","廿","三"][Math.floor(n/10)]+["十","一","二","三","四","五","六","七","八","九"][n%10]}const d=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],f=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];function g(n,t){const a=d.indexOf(n),e=f.indexOf(t);return d[(a%5*2+e)%10]}function Z(t,a){try{const e=t.getHours();let r=new Date(t);e>=23&&r.setDate(r.getDate()+1);const o=n.Solar.fromDate(t).getLunar(),h=n.Solar.fromDate(r).getLunar();let i,u,m,c;if(o.getBaZiYearGanZhi?(i=o.getBaZiYearGanZhi(),u=o.getBaZiMonthGanZhi(),m=o.getBaZiDayGanZhi(),c=o.getBaZiHourGanZhi()):(i=o.getYearInGanZhiByLiChun?o.getYearInGanZhiByLiChun():o.getYearInGanZhi(),u=o.getMonthInGanZhiExact?o.getMonthInGanZhiExact():o.getMonthInGanZhi(),m=h.getDayInGanZhi(),c=o.getTimeInGanZhi()),a){c=g(m.charAt(0),a)+a}return{year:i,month:u,day:m,hour:c,yearGan:i.charAt(0),yearZhi:i.charAt(1),monthGan:u.charAt(0),monthZhi:u.charAt(1),dayGan:m.charAt(0),dayZhi:m.charAt(1),hourGan:c.charAt(0),hourZhi:c.charAt(1)}}catch(e){return console.error("lunar-javascript 计算四柱失败:",e),null}}function D(n,t){const a=Z(n,t);return a||(console.warn("使用简化四柱计算，结果可能不够精确。请安装 lunar-javascript 库：npm install lunar-javascript"),function(n,t){let a=n.getFullYear();n.getMonth(),n.getDate();const r=n.getHours();let o=new Date(n);r>=23&&o.setDate(o.getDate()+1);const h=e(n);["小寒","大寒","冬至"].includes(h)&&(a-=1);const i=a-1984;let u=i%10,m=i%12;u<0&&(u+=10),m<0&&(m+=12);const c=d[u],s=f[m];let l={"立春":"寅","雨水":"寅","惊蛰":"卯","春分":"卯","清明":"辰","谷雨":"辰","立夏":"巳","小满":"巳","芒种":"午","夏至":"午","小暑":"未","大暑":"未","立秋":"申","处暑":"申","白露":"酉","秋分":"酉","寒露":"戌","霜降":"戌","立冬":"亥","小雪":"亥","大雪":"子","冬至":"子","小寒":"丑","大寒":"丑"}[h]||"寅",y=f.indexOf(l);const Z=d.indexOf(c)%5,D=d[((2*Z+2)%10+(y-2+12)%12)%10],G=new Date(2e3,0,7),M=Math.floor((o-G)/864e5);let x=M%10,I=M%12;x<0&&(x+=10),I<0&&(I+=12);const A=d[x],Y=f[I],$=t||f[Math.floor((r+1)/2)%12],p=g(A,$);return{year:c+s,month:D+l,day:A+Y,hour:p+$,yearGan:c,yearZhi:s,monthGan:D,monthZhi:l,dayGan:A,dayZhi:Y,hourGan:p,hourZhi:$}}(n,t))}function G(t){if(n.Solar&&n.Lunar)try{const a=t.getHours();let e=new Date(t);a>=23&&e.setDate(e.getDate()+1);const r=n.Solar.fromDate(e).getLunar(),o=r.getYearZhi(),h=f.indexOf(o)+1,i=Math.abs(r.getMonth()),u=r.getDay(),m=r.getTimeZhi();return{yearNum:h,monthNum:i,dayNum:u,hourNum:f.indexOf(m)+1,lunarStr:`${r.getYearInGanZhi()}年 ${r.getMonthInChinese()}月${r.getDayInChinese()} ${m}时`}}catch(a){console.error("Lunar lib error, using fallback:",a)}try{const n=t.getHours();let a=new Date(t);n>=23&&a.setDate(a.getDate()+1);const e=s(a);if(!e)return null;const r=(e.year-4)%12+1,o=(e.year-4)%10,h=d[o],i=f[r-1],u=e.month,m=e.day,c=Math.floor((n+1)/2)%12,g=c+1,Z=f[c];return{yearNum:r,monthNum:u,dayNum:m,hourNum:g,lunarStr:`${h}${i}年 ${l(u)}月${y(m)} ${Z}时`}}catch(a){return console.error("Fallback lunar calculation error:",a),null}}export{D as a,G as b,Z as c,o as d,r as e,l as f,h as g,y as h,s};
