const n=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],t={"雨水":"亥","惊蛰":"亥","春分":"戌","清明":"戌","谷雨":"酉","立夏":"酉","小满":"申","芒种":"申","夏至":"未","小暑":"未","大暑":"午","立秋":"午","处暑":"巳","白露":"巳","秋分":"辰","寒露":"辰","霜降":"卯","立冬":"卯","小雪":"寅","大雪":"寅","冬至":"丑","小寒":"丑","大寒":"子","立春":"子"};function a(n){const t=n.getMonth()+1,a=n.getDate(),e=[{name:"小寒",month:1,day:6},{name:"大寒",month:1,day:20},{name:"立春",month:2,day:4},{name:"雨水",month:2,day:19},{name:"惊蛰",month:3,day:6},{name:"春分",month:3,day:21},{name:"清明",month:4,day:5},{name:"谷雨",month:4,day:20},{name:"立夏",month:5,day:6},{name:"小满",month:5,day:21},{name:"芒种",month:6,day:6},{name:"夏至",month:6,day:21},{name:"小暑",month:7,day:7},{name:"大暑",month:7,day:23},{name:"立秋",month:8,day:8},{name:"处暑",month:8,day:23},{name:"白露",month:9,day:8},{name:"秋分",month:9,day:23},{name:"寒露",month:10,day:8},{name:"霜降",month:10,day:24},{name:"立冬",month:11,day:8},{name:"小雪",month:11,day:22},{name:"大雪",month:12,day:7},{name:"冬至",month:12,day:22}];let r="冬至";for(let o=0;o<e.length;o++){const n=e[o];if(t<n.month||t===n.month&&a<n.day)break;r=n.name}return r}function e(e,r){const o=a(e),h=function(n){return t[n]||"子"}(o),u=function(t,a){const e=n.indexOf(t),r=n.indexOf(a),o={};for(let h=0;h<12;h++){const t=(e+h-r+12)%12;o[n[h]]=n[t]}return o}(h,r);return{jieqi:o,yuejiang:h,tianpan:u,shichen:r}}const r=[19416,19168,42352,21717,53856,55632,91476,22176,39632,21970,19168,42422,42192,53840,119381,46400,54944,44450,38320,84343,18800,42160,46261,27216,27968,109396,11104,38256,21234,18800,25958,54432,59984,28309,23248,11104,100067,37600,116951,51536,54432,120998,46416,22176,107956,9680,37584,53938,43344,46423,27808,46416,86869,19872,42448,83315,21200,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46496,103846,38320,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,21952,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,86390,21168,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19415,19152,42192,118966,53840,54560,56645,46496,22224,21938,18864,42359,42160,43600,111189,27936,44448];function o(n){let t,a=348;for(t=32768;t>8;t>>=1)a+=r[n-1900]&t?1:0;return a+h(n)}function h(n){return u(n)?65536&r[n-1900]?30:29:0}function u(n){return 15&r[n-1900]}let i,m;try{const n=require("lunar-javascript");i=n.Solar,m=n.Lunar}catch(g){console.warn("lunar-javascript 库未安装，将使用简化计算")}const c=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],l=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];function y(n,t){const a=c.indexOf(n),e=l.indexOf(t);return c[(a%5*2+e)%10]}function s(n,t){const e=function(n,t){if(!i||!m)return null;try{const a=n.getHours();let e=new Date(n);a>=23&&e.setDate(e.getDate()+1);const r=i.fromDate(n).getLunar(),o=i.fromDate(e).getLunar();let h,u,m,c;return r.getBaZiYearGanZhi?(h=r.getBaZiYearGanZhi(),u=r.getBaZiMonthGanZhi(),m=r.getBaZiDayGanZhi(),c=r.getBaZiHourGanZhi()):(h=r.getYearInGanZhiByLiChun?r.getYearInGanZhiByLiChun():r.getYearInGanZhi(),u=r.getMonthInGanZhiExact?r.getMonthInGanZhiExact():r.getMonthInGanZhi(),m=o.getDayInGanZhi(),c=r.getTimeInGanZhi()),t&&(c=y(m.charAt(0),t)+t),{year:h,month:u,day:m,hour:c,yearGan:h.charAt(0),yearZhi:h.charAt(1),monthGan:u.charAt(0),monthZhi:u.charAt(1),dayGan:m.charAt(0),dayZhi:m.charAt(1),hourGan:c.charAt(0),hourZhi:c.charAt(1)}}catch(g){return console.error("lunar-javascript 计算四柱失败:",g),null}}(n,t);return e||(console.warn("使用简化四柱计算，结果可能不够精确。请安装 lunar-javascript 库：npm install lunar-javascript"),function(n,t){let e=n.getFullYear();n.getMonth(),n.getDate();const r=n.getHours();let o=new Date(n);r>=23&&o.setDate(o.getDate()+1);const h=a(n);["小寒","大寒","冬至"].includes(h)&&(e-=1);const u=e-1984;let i=u%10,m=u%12;i<0&&(i+=10),m<0&&(m+=12);const s=c[i],d=l[m];let g={"立春":"寅","雨水":"寅","惊蛰":"卯","春分":"卯","清明":"辰","谷雨":"辰","立夏":"巳","小满":"巳","芒种":"午","夏至":"午","小暑":"未","大暑":"未","立秋":"申","处暑":"申","白露":"酉","秋分":"酉","寒露":"戌","霜降":"戌","立冬":"亥","小雪":"亥","大雪":"子","冬至":"子","小寒":"丑","大寒":"丑"}[h]||"寅",f=l.indexOf(g);const Z=c.indexOf(s)%5,D=c[((2*Z+2)%10+(f-2+12)%12)%10],G=new Date(2e3,0,7),M=Math.floor((o-G)/864e5);let x=M%10,I=M%12;x<0&&(x+=10),I<0&&(I+=12);const p=c[x],A=l[I],Y=t||l[Math.floor((r+1)/2)%12],$=y(p,Y);return{year:s+d,month:D+g,day:p+A,hour:$+Y,yearGan:s,yearZhi:d,monthGan:D,monthZhi:g,dayGan:p,dayZhi:A,hourGan:$,hourZhi:Y}}(n,t))}function d(n){if(i&&m)try{const t=n.getHours();let a=new Date(n);t>=23&&a.setDate(a.getDate()+1);const e=i.fromDate(a).getLunar(),r=e.getYearZhi(),o=l.indexOf(r)+1,h=Math.abs(e.getMonth()),u=e.getDay(),m=e.getTimeZhi();return{yearNum:o,monthNum:h,dayNum:u,hourNum:l.indexOf(m)+1,lunarStr:`${e.getYearInGanZhi()}年 ${e.getMonthInChinese()}月${e.getDayInChinese()} ${m}时`}}catch(g){console.error("Lunar lib error, using fallback:",g)}try{const e=n.getHours();let i=new Date(n);e>=23&&i.setDate(i.getDate()+1);const m=function(n){let t,a,e,i,m=0,c=0,l=(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())-Date.UTC(1900,0,31))/864e5;if(l<0)return null;for(t=1900;t<2050&&l>0;t++)c=o(t),l-=c;l<0&&(l+=c,t--),a=t,m=u(t);let y=!1;for(t=1;t<13&&l>0;t++)m>0&&t===m+1&&!y?(--t,y=!0,c=h(a)):c=r[a-1900]&65536>>t?30:29,y&&t===m+1&&(y=!1),l-=c;return 0===l&&m>0&&t===m+1&&(y?y=!1:(y=!0,--t)),l<0&&(l+=c,--t),e=t,i=l+1,{year:a,month:e,day:i,isLeap:y}}(i);if(!m)return null;const y=(m.year-4)%12+1,s=(m.year-4)%10,d=c[s],g=l[y-1],f=m.month,Z=m.day,D=Math.floor((e+1)/2)%12,G=D+1,M=l[D];return{yearNum:y,monthNum:f,dayNum:Z,hourNum:G,lunarStr:`${d}${g}年 ${a=f,["正","二","三","四","五","六","七","八","九","十","冬","腊"][a-1]}月${t=Z,10===t?"初十":20===t?"二十":30===t?"三十":["初","十","廿","三"][Math.floor(t/10)]+["十","一","二","三","四","五","六","七","八","九"][t%10]} ${M}时`}}catch(g){return console.error("Fallback lunar calculation error:",g),null}var t,a}export{s as a,d as b,e as g};
